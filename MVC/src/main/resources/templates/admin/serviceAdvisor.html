<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Albany Motors - Service Advisor Management</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
  <!-- Google Fonts - Baloo Bhaijaan 2 -->
  <link href="https://fonts.googleapis.com/css2?family=Baloo+Bhaijaan+2:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --dutch-white: #EFFBBB; /* Dutch White */
      --secondary-color: #722F37; /* Wine */
      --text-dark: #2D2D2D;
      --text-light: #FFFFFF;
      --accent-gold: #D4AF37;
      --bg-light: #F8F9FA;
      --light-gray: #e9ecef;
      --medium-gray: #adb5bd;
      --dark-gray: #495057;
      --danger: #ef5350;
      --warning: #ffca28;
      --success: #66bb6a;
      --info: #42a5f5;

      --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
      --shadow-lg: 0 8px 16px rgba(0,0,0,0.1);
      --shadow-xl: 0 12px 24px rgba(0,0,0,0.15);

      --radius-sm: 0.25rem;
      --radius-md: 0.5rem;
      --radius-lg: 1rem;

      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body, html {
      font-family: 'Baloo Bhaijaan 2', sans-serif;
      background-color: #f8f9fa;
      color: var(--text-dark);
      min-height: 100vh;
      scroll-behavior: smooth;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: transparent;
      z-index: -1;
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    ::-webkit-scrollbar-track {
      background: var(--light-gray);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--secondary-color);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: #8a3943;
    }

    .app-container {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    /* Sidebar Styles */
    .sidebar {
      width: 280px;
      background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
      color: var(--text-light);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 1000;
      transition: var(--transition);
      display: flex;
      flex-direction: column;
      box-shadow: var(--shadow-xl);
    }

    .sidebar-header {
      padding: 1.75rem 1.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .sidebar-header h2 {
      margin-bottom: 0;
      font-weight: 700;
      color: var(--text-light);
      font-size: 1.75rem;
      letter-spacing: 0.5px;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
    }

    .sidebar-content {
      flex: 1;
      overflow-y: auto;
      padding: 1rem 0;
    }

    .nav-section {
      margin-bottom: 1.5rem;
    }

    .nav-section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0.75rem 1.5rem;
      color: rgba(255, 255, 255, 0.8);
      font-weight: 600;
    }

    .sidebar-menu {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-menu-item {
      padding: 0 0.75rem;
      margin-bottom: 0.25rem;
    }

    .sidebar-menu-link {
      display: flex;
      align-items: center;
      padding: 0.85rem 1rem;
      color: rgba(255, 255, 255, 0.95);
      text-decoration: none;
      border-radius: var(--radius-md);
      transition: var(--transition);
      position: relative;
    }

    .sidebar-menu-link:hover {
      background-color: rgba(255, 255, 255, 0.1);
      color: var(--text-light);
    }

    .sidebar-menu-link.active {
      background-color: var(--dutch-white);
      color: var(--secondary-color);
      font-weight: 600;
      box-shadow: var(--shadow-sm);
    }

    .sidebar-menu-link.active::before {
      content: '';
      position: absolute;
      left: -0.75rem;
      top: 50%;
      transform: translateY(-50%);
      height: 2rem;
      width: 4px;
      background-color: #d6e297;
      border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
    }

    .sidebar-menu-link i {
      width: 1.5rem;
      text-align: center;
      font-size: 1.1rem;
      margin-right: 0.75rem;
    }

    .sidebar-footer {
      padding: 1rem 1.5rem;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .user-info {
      display: flex;
      flex-direction: column;
    }

    .user-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text-light);
    }

    .user-role {
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.8);
    }

    .logout-btn {
      padding: 0.5rem 1rem;
      background-color: rgba(255, 255, 255, 0.1);
      border: none;
      border-radius: var(--radius-md);
      color: var(--text-light);
      font-size: 0.9rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      cursor: pointer;
      transition: var(--transition);
    }

    .logout-btn:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* Main Content Styles */
    .main-content {
      flex: 1;
      margin-left: 280px;
      padding: 2rem;
      transition: var(--transition);
      color: var(--text-dark);
    }

    /* Header Styles */
    .page-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 2rem;
      background-color: transparent;
      padding: 0;
      border-radius: 0;
      box-shadow: none;
      position: relative;
    }

    .header-left {
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .header-left h1 {
      font-size: 2.5rem;
      font-weight: 800;
      color: var(--secondary-color);
      margin-bottom: 0.5rem;
      position: relative;
      letter-spacing: 1px;
      text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
    }

    .header-subtitle {
      font-size: 1rem;
      color: var(--medium-gray);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .action-buttons {
      display: flex;
      gap: 1rem;
    }

    /* Premium Button */
    .btn-premium {
      padding: 0.75rem 1.5rem;
      border-radius: var(--radius-lg);
      font-size: 0.95rem;
      font-weight: 600;
      transition: var(--transition);
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      box-shadow: var(--shadow-md);
      cursor: pointer;
    }

    .btn-premium.primary {
      background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
      color: white;
    }

    .btn-premium.primary:hover {
      box-shadow: 0 6px 15px rgba(114, 47, 55, 0.3);
      transform: translateY(-2px);
    }

    .btn-premium.secondary {
      background-color: var(--bg-light);
      color: var(--secondary-color);
      border: 1px solid var(--light-gray);
    }

    .btn-premium.secondary:hover {
      background-color: var(--light-gray);
      border-color: var(--secondary-color);
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }

    /* Search Box */
    .search-box {
      position: relative;
      max-width: 400px;
      margin-bottom: 2rem;
    }

    .search-input {
      padding: 1rem 1rem 1rem 3rem;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-lg);
      width: 100%;
      font-size: 1rem;
      color: var(--text-dark);
      box-shadow: var(--shadow-sm);
      transition: var(--transition);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--secondary-color);
      box-shadow: 0 0 0 4px rgba(114, 47, 55, 0.1);
    }

    .search-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--medium-gray);
      pointer-events: none;
    }

    /* Filters Section */
    .filters-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .filter-pills {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .filter-pill {
      padding: 0.5rem 1rem;
      background-color: var(--bg-light);
      border: 1px solid var(--light-gray);
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--dark-gray);
      cursor: pointer;
      transition: var(--transition);
    }

    .filter-pill:hover {
      background-color: var(--light-gray);
    }

    .filter-pill.active {
      background-color: var(--secondary-color);
      color: white;
      border-color: var(--secondary-color);
    }

    .sort-dropdown .dropdown-toggle {
      padding: 0.5rem 1rem;
      background-color: var(--bg-light);
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--dark-gray);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .sort-dropdown .dropdown-toggle:hover,
    .sort-dropdown .dropdown-toggle:focus {
      background-color: var(--light-gray);
      border-color: var(--medium-gray);
    }

    .sort-dropdown .dropdown-menu {
      border: none;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      padding: 0.5rem;
      min-width: 10rem;
    }

    .sort-dropdown .dropdown-item {
      padding: 0.6rem 1rem;
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      color: var(--dark-gray);
      transition: var(--transition);
    }

    .sort-dropdown .dropdown-item:hover {
      background-color: rgba(114, 47, 55, 0.1);
      color: var(--secondary-color);
    }

    .sort-dropdown .dropdown-item.active {
      background-color: var(--secondary-color);
      color: white;
    }

    /* Advisor Cards Grid */
    .advisors-grid-container {
      margin-bottom: 2rem;
    }

    .advisors-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .advisor-card {
      background: white;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
      cursor: pointer;
      display: flex;
      flex-direction: column;
      height: 100%;
    }

    .advisor-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-lg);
    }

    .advisor-card-header {
      background-color: var(--bg-light);
      padding: 1.25rem;
      border-bottom: 1px solid var(--light-gray);
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .advisor-avatar {
      width: 3.5rem;
      height: 3.5rem;
      border-radius: 50%;
      background-color: var(--dutch-white);
      color: var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      font-weight: 600;
      flex-shrink: 0;
    }

    .advisor-header-info {
      display: flex;
      flex-direction: column;
    }

    .advisor-name {
      font-weight: 600;
      color: var(--secondary-color);
      font-size: 1.1rem;
      margin-bottom: 0.25rem;
    }

    .advisor-id {
      font-size: 0.85rem;
      color: var(--medium-gray);
    }

    .advisor-card-body {
      padding: 1.25rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
      flex: 1;
    }

    .advisor-detail {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .advisor-detail-icon {
      width: 1.75rem;
      height: 1.75rem;
      border-radius: var(--radius-md);
      background-color: rgba(114, 47, 55, 0.1);
      color: var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      flex-shrink: 0;
    }

    .advisor-detail-content {
      display: flex;
      flex-direction: column;
    }

    .advisor-detail-label {
      font-size: 0.8rem;
      color: var(--medium-gray);
    }

    .advisor-detail-value {
      font-size: 0.95rem;
      color: var(--text-dark);
      font-weight: 500;
    }


    .advisor-card-footer {
      padding: 1rem 1.25rem;
      border-top: 1px solid var(--light-gray);
      background-color: var(--bg-light);
    }

    .workload-container {
      width: 100%;
      background-color: var(--light-gray);
      border-radius: 50px;
      height: 0.65rem;
      overflow: hidden;
      margin-bottom: 0.5rem;
    }

    .workload-progress {
      height: 100%;
      border-radius: 50px;
      background: linear-gradient(90deg, #66bb6a 0%, #43a047 100%);
      transition: width 0.5s ease;
    }

    .workload-progress.high {
      background: linear-gradient(90deg, #ef5350 0%, #e53935 100%);
    }

    .workload-progress.medium {
      background: linear-gradient(90deg, #ffca28 0%, #ffb300 100%);
    }

    .workload-text {
      font-size: 0.85rem;
      font-weight: 600;
      color: var(--dark-gray);
      display: flex;
      justify-content: space-between;
    }

    .workload-label {
      color: var(--secondary-color);
    }

    .no-advisors-message {
      grid-column: 1 / -1;
      text-align: center;
      padding: 3rem;
      background: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
    }

    /* Pagination */
    .pagination-container {
      display: flex;
      justify-content: center;
      margin-top: 2rem;
    }

    .pagination {
      display: flex;
      gap: 0.35rem;
      background-color: white;
      border-radius: 50px;
      padding: 0.5rem;
      box-shadow: var(--shadow-lg);
    }

    .page-item .page-link {
      width: 2.5rem;
      height: 2.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      color: var(--dark-gray);
      font-weight: 500;
      border: none;
      transition: var(--transition);
      background-color: transparent;
    }

    .page-item .page-link:hover {
      background-color: var(--light-gray);
    }

    .page-item.active .page-link {
      background-color: var(--secondary-color);
      color: white;
      box-shadow: var(--shadow-md);
    }

    .page-item.disabled .page-link {
      color: var(--medium-gray);
      pointer-events: none;
      opacity: 0.6;
    }

    /* Service Advisor Details Modal - Premium Design */
    .premium-modal {
      --modal-padding: 0;
    }

    .premium-modal .modal-content {
      border: none;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      position: relative;
    }

    .premium-modal .modal-header {
      background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
      color: white;
      padding: 1.75rem 2rem;
      border-bottom: none;
      position: relative;
    }

    .premium-modal .modal-title {
      font-weight: 700;
      font-size: 1.35rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .premium-modal .modal-title i {
      width: 2.5rem;
      height: 2.5rem;
      background-color: rgba(255, 255, 255, 0.15);
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
    }

    .premium-modal .modal-body {
      padding: 0;
    }

    .premium-modal .modal-body-inner {
      padding: 2.5rem;
    }

    .premium-modal .modal-footer {
      padding: 1.5rem 2.5rem;
      border-top: 1px solid var(--light-gray);
      background-color: rgba(248, 249, 250, 0.5);
    }

    .premium-modal .btn-close {
      color: white;
      opacity: 0.8;
      box-shadow: none;
      width: 2rem;
      height: 2rem;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .premium-modal .btn-close:hover {
      opacity: 1;
      background-color: rgba(255, 255, 255, 0.2);
    }

    /* Service Advisor profile tabs */
    .profile-tabs {
      background-color: var(--bg-light);
      display: flex;
      padding: 0 2.5rem;
      border-bottom: 1px solid var(--light-gray);
    }

    .profile-tab {
      padding: 1.25rem 1.5rem;
      font-weight: 600;
      color: var(--dark-gray);
      position: relative;
      cursor: pointer;
      transition: var(--transition);
    }

    .profile-tab:hover {
      color: var(--secondary-color);
    }

    .profile-tab.active {
      color: var(--secondary-color);
    }

    .profile-tab.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background-color: var(--secondary-color);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .advisor-profile {
      display: flex;
      gap: 2rem;
      margin-bottom: 2rem;
      padding-bottom: 2rem;
      border-bottom: 1px solid var(--light-gray);
      flex-wrap: wrap;
    }

    .profile-section {
      flex: 1;
      min-width: 260px;
    }

    .profile-avatar {
      width: 6rem;
      height: 6rem;
      border-radius: 50%;
      background-color: var(--dutch-white);
      color: var(--secondary-color);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.5rem;
      font-weight: 600;
      margin-bottom: 1.5rem;
    }

    .profile-detail {
      margin-bottom: 1.25rem;
    }

    .profile-label {
      font-size: 0.85rem;
      color: var(--medium-gray);
      margin-bottom: 0.35rem;
    }

    .profile-value {
      font-size: 1rem;
      font-weight: 500;
      color: var(--text-dark);
    }

    .section-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--secondary-color);
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .section-title i {
      color: var(--secondary-color);
    }

    .workload-overview {
      margin-bottom: 2rem;
    }

    .workload-card {
      background-color: white;
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .workload-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .workload-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--dark-gray);
    }

    .workload-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--secondary-color);
    }

    .active-services-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      background-color: white;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }

    .active-services-table th {
      padding: 1rem;
      font-size: 0.9rem;
      color: var(--dark-gray);
      background-color: var(--bg-light);
      font-weight: 600;
      text-align: left;
      border-bottom: 1px solid var(--light-gray);
    }

    .active-services-table td {
      padding: 1rem;
      font-size: 0.9rem;
      border-bottom: 1px solid var(--light-gray);
      vertical-align: middle;
    }

    .active-services-table tr:last-child td {
      border-bottom: none;
    }

    .service-status {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.35rem 0.75rem;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .service-status.completed {
      background-color: rgba(102, 187, 106, 0.15);
      color: var(--success);
    }

    .service-status.diagnosis {
      background-color: rgba(255, 202, 40, 0.15);
      color: #ff8f00;
    }

    .service-status.repair {
      background-color: rgba(33, 150, 243, 0.15);
      color: #1976d2;
    }

    .service-status.received {
      background-color: rgba(158, 158, 158, 0.15);
      color: #616161;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--dark-gray);
    }

    .form-control {
      display: block;
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      color: var(--text-dark);
      background-color: #fff;
      background-clip: padding-box;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-md);
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .form-control:focus {
      color: var(--text-dark);
      background-color: #fff;
      border-color: var(--secondary-color);
      outline: 0;
      box-shadow: 0 0 0 0.25rem rgba(114, 47, 55, 0.25);
    }

    .form-select {
      display: block;
      width: 100%;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      color: var(--text-dark);
      background-color: #fff;
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
      background-repeat: no-repeat;
      background-position: right 1rem center;
      background-size: 16px 12px;
      border: 1px solid var(--light-gray);
      border-radius: var(--radius-md);
      appearance: none;
      transition: var(--transition);
      box-shadow: var(--shadow-sm);
    }

    .form-select:focus {
      border-color: var(--secondary-color);
      outline: 0;
      box-shadow: 0 0 0 0.25rem rgba(114, 47, 55, 0.25);
    }

    /* Premium Modal Buttons */
    .premium-btn {
      padding: 0.85rem 1.75rem;
      border-radius: var(--radius-lg);
      font-size: 0.95rem;
      font-weight: 600;
      transition: all 0.3s cubic-bezier(0.25, 1, 0.5, 1);
      border: none;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      position: relative;
      overflow: hidden;
      box-shadow: var(--shadow-md);
      z-index: 1;
    }

    .premium-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 0;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.1);
      z-index: -1;
      transition: width 0.4s ease;
    }

    .premium-btn:hover::before {
      width: 100%;
    }

    .premium-btn:active {
      transform: scale(0.98);
    }

    .premium-btn.primary {
      background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
      color: white;
    }

    .premium-btn.primary:hover {
      box-shadow: 0 8px 25px rgba(114, 47, 55, 0.35);
      transform: translateY(-2px);
    }

    .premium-btn.secondary {
      background-color: var(--bg-light);
      color: var(--secondary-color);
      border: 1px solid rgba(114, 47, 55, 0.2);
    }

    .premium-btn.secondary:hover {
      background-color: rgba(114, 47, 55, 0.05);
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .premium-btn.danger {
      background: linear-gradient(145deg, #ef5350 0%, #d32f2f 100%);
      color: white;
    }

    .premium-btn.danger:hover {
      box-shadow: 0 8px 25px rgba(211, 47, 47, 0.35);
      transform: translateY(-2px);
    }

    /* Creative Albany Spinner */
    .spinner-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
    }

    .spinner-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .spinner-container {
      position: relative;
      width: 120px;
      height: 120px;
      perspective: 300px;
    }

    .albany-spinner {
      width: 100%;
      height: 100%;
      position: relative;
      transform-style: preserve-3d;
      animation: spin 3s infinite cubic-bezier(0.68, -0.55, 0.27, 1.55);
    }

    .spinner-letter {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 72px;
      font-weight: 800;
      color: var(--secondary-color);
      text-shadow: 0 0 5px rgba(114, 47, 55, 0.3);
      backface-visibility: hidden;
      transform: rotateY(0deg) translateZ(60px);
      font-family: 'Baloo Bhaijaan 2', sans-serif;
    }

    .spinner-circle {
      position: absolute;
      top: -10px;
      left: -10px;
      width: calc(100% + 20px);
      height: calc(100% + 20px);
      border-radius: 50%;
      border: 4px solid transparent;
      border-top-color: var(--secondary-color);
      border-bottom-color: var(--dutch-white);
      animation: spin-reverse 1.5s linear infinite;
    }

    .spinner-circle:nth-child(2) {
      top: -5px;
      left: -5px;
      width: calc(100% + 10px);
      height: calc(100% + 10px);
      border-top-color: var(--dutch-white);
      border-bottom-color: var(--secondary-color);
      animation-duration: 2s;
    }

    .spinner-text {
      position: absolute;
      bottom: -40px;
      left: 0;
      width: 100%;
      text-align: center;
      font-size: 16px;
      font-weight: 600;
      color: var(--secondary-color);
    }

    @keyframes spin {
      0% {
        transform: rotateY(0deg);
      }
      25% {
        transform: rotateY(90deg);
      }
      50% {
        transform: rotateY(180deg);
      }
      75% {
        transform: rotateY(270deg);
      }
      100% {
        transform: rotateY(360deg);
      }
    }

    @keyframes spin-reverse {
      from {
        transform: rotate(0deg);
      }
      to {
        transform: rotate(360deg);
      }
    }

    /* Confirmation Modal */
    .confirmation-modal .modal-content {
      border: none;
      border-radius: var(--radius-lg);
      overflow: hidden;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
      text-align: center;
    }

    .confirmation-modal .modal-body {
      padding: 3rem 2rem;
      position: relative;
    }

    .confirmation-icon {
      width: 90px;
      height: 90px;
      background: linear-gradient(145deg, #66BB6A, #43A047);
      border-radius: 50%;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.75rem;
      margin: 0 auto 1.5rem;
      box-shadow: 0 10px 20px rgba(102, 187, 106, 0.3);
    }

    .confirmation-title {
      font-size: 1.75rem;
      font-weight: 700;
      color: #333;
      margin-bottom: 1rem;
    }

    .confirmation-message {
      font-size: 1.1rem;
      color: #555;
      margin-bottom: 2rem;
      line-height: 1.6;
    }

    .confirmation-btn {
      padding: 0.85rem 2.5rem;
      background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
      color: white;
      border: none;
      border-radius: var(--radius-lg);
      font-size: 1rem;
      font-weight: 600;
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .confirmation-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(114, 47, 55, 0.35);
    }

    /* Responsive Styles */
    @media (max-width: 991.98px) {
      .sidebar {
        width: 5rem;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
      }

      .sidebar-header h2,
      .sidebar-menu-link span,
      .user-info,
      .nav-section-title,
      .logout-btn span {
        display: none;
      }

      .sidebar-menu-link {
        justify-content: center;
        padding: 0.75rem;
      }

      .sidebar-menu-link i {
        margin-right: 0;
        font-size: 1.25rem;
      }

      .sidebar-menu-link.active::before {
        left: -0.5rem;
      }

      .sidebar-footer {
        justify-content: center;
        padding: 1rem;
      }

      .logout-btn {
        padding: 0.5rem;
        justify-content: center;
      }

      .main-content {
        margin-left: 5rem;
      }

      .page-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 1rem;
      }

      .header-left h1 {
        font-size: 2rem;
      }

      .filters-section {
        flex-direction: column;
        align-items: flex-start;
      }
    }

    @media (max-width: 767.98px) {
      .sidebar {
        width: 0;
        transform: translateX(-100%);
      }

      .sidebar.active {
        width: 280px;
        transform: translateX(0);
      }

      .sidebar.active .sidebar-header h2,
      .sidebar.active .sidebar-menu-link span,
      .sidebar.active .user-info,
      .sidebar.active .nav-section-title,
      .sidebar.active .logout-btn span {
        display: block;
      }

      .sidebar.active .sidebar-menu-link {
        justify-content: flex-start;
        padding: 0.85rem 1rem;
      }

      .sidebar.active .sidebar-menu-link i {
        margin-right: 0.75rem;
      }

      .sidebar.active .sidebar-footer {
        justify-content: space-between;
        padding: 1rem 1.5rem;
      }

      .sidebar.active .logout-btn {
        padding: 0.5rem 1rem;
        justify-content: center;
      }

      .main-content {
        margin-left: 0;
      }

      .mobile-menu-toggle {
        display: block;
        position: fixed;
        top: 1rem;
        left: 1rem;
        z-index: 1050;
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background: linear-gradient(145deg, #722F37 0%, #5e262e 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: var(--shadow-md);
        cursor: pointer;
      }

      .page-header {
        padding-top: 4rem;
      }

      .advisors-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 575.98px) {
      .main-content {
        padding: 1rem;
      }

      .page-header {
        margin-bottom: 1.5rem;
      }

      .header-left h1 {
        font-size: 1.75rem;
      }

      .action-buttons {
        flex-direction: column;
        gap: 0.75rem;
        width: 100%;
      }

      .btn-premium {
        width: 100%;
        justify-content: center;
      }

      .search-box {
        max-width: 100%;
      }

      .advisor-profile {
        gap: 1rem;
      }

      .profile-section {
        flex: 100%;
        min-width: 100%;
      }
    }
  </style>
</head>
<body>
<!-- Creative Albany Spinner Overlay -->
<div class="spinner-overlay" id="spinnerOverlay">
  <div class="spinner-container">
    <div class="albany-spinner">
      <div class="spinner-letter">A</div>
      <div class="spinner-circle"></div>
      <div class="spinner-circle"></div>
    </div>
    <div class="spinner-text">Loading...</div>
  </div>
</div>

<!-- Mobile Menu Toggle Button (for small screens) -->
<button class="mobile-menu-toggle" id="mobileMenuToggle">
  <i class="fas fa-bars"></i>
</button>

<div class="app-container">
  <!-- Sidebar Navigation -->
  <aside class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>Albany</h2>
    </div>

    <div class="sidebar-content">
      <div class="nav-section">
        <div class="nav-section-title">Main</div>
        <ul class="sidebar-menu">
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/dashboard}" class="sidebar-menu-link">
              <i class="fas fa-tachometer-alt"></i>
              <span>Dashboard</span>
            </a>
          </li>
        </ul>
      </div>

      <div class="nav-section">
        <div class="nav-section-title">Management</div>
        <ul class="sidebar-menu">
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/service-requests}" class="sidebar-menu-link">
              <i class="fas fa-clipboard-list"></i>
              <span>Service Requests</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/vehicles}" class="sidebar-menu-link">
              <i class="fas fa-car"></i>
              <span>Vehicles</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/customers}" class="sidebar-menu-link">
              <i class="fas fa-users"></i>
              <span>Customers</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/service-advisors}" class="sidebar-menu-link active">
              <i class="fas fa-user-tie"></i>
              <span>Service Advisors</span>
            </a>
          </li>
          <li class="sidebar-menu-item">
            <a th:href="@{/admin/inventory}" class="sidebar-menu-link">
              <i class="fas fa-boxes"></i>
              <span>Inventory</span>
            </a>
          </li>

          <!--          <li class="sidebar-menu-item">-->
          <!--            <a href="#" class="sidebar-menu-link">-->
          <!--              <i class="fas fa-file-invoice-dollar"></i>-->
          <!--              <span>Invoices</span>-->
          <!--            </a>-->
          <!--          </li>-->
          <!--          <li class="sidebar-menu-item">-->
          <!--            <a href="#" class="sidebar-menu-link">-->
          <!--              <i class="fas fa-rupee-sign"></i>-->
          <!--              <span>Payments</span>-->
          <!--            </a>-->
          <!--          </li>-->
        </ul>
      </div>
    </div>

    <div class="sidebar-footer">
      <div class="user-info">
        <div class="user-name">Arthur Morgan</div>
        <div class="user-role">Administrator</div>
      </div>
      <button class="logout-btn" id="logoutBtn">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </aside>

  <!-- Main Content Area -->
  <main class="main-content">
    <!-- Page Header -->
    <header class="page-header">
      <div class="header-left">
        <h1>Service Advisor Management</h1>
        <div class="header-subtitle">
          <i class="fas fa-user-tie"></i>
          Manage service advisors, assign workload, and track performance
        </div>
      </div>

      <div class="action-buttons">
        <button class="btn-premium primary" id="addAdvisorBtn">
          <i class="fas fa-user-plus"></i>
          Add New Service Advisor
        </button>
      </div>
    </header>

    <!-- Search Box -->
    <div class="search-box">
      <input type="text" class="search-input" id="advisorSearch" placeholder="Search for service advisors by name, email, or ID...">
      <i class="fas fa-search search-icon"></i>
    </div>

    <!-- Filters Section -->
    <section class="filters-section">
      <div class="filter-pills">
        <div class="filter-pill active">All Advisors</div>
        <div class="filter-pill">High Workload</div>
        <div class="filter-pill">Available</div>
      </div>

      <div class="dropdown sort-dropdown">
        <button class="dropdown-toggle" type="button" id="sortDropdown" data-bs-toggle="dropdown" aria-expanded="false">
          <i class="fas fa-sort"></i>
          Sort by: Name
        </button>
        <ul class="dropdown-menu" aria-labelledby="sortDropdown">
          <li><a class="dropdown-item active" href="#">Name</a></li>
          <li><a class="dropdown-item" href="#">Department</a></li>
          <li><a class="dropdown-item" href="#">Workload</a></li>
          <li><a class="dropdown-item" href="#">Hire Date</a></li>
        </ul>
      </div>
    </section>

    <!-- Service Advisors Grid -->
    <section class="advisors-grid-container">
      <div class="advisors-grid" id="advisorsGrid">
        <!-- Grid items will be populated here -->
      </div>
    </section>

    <!-- Pagination -->
    <nav class="pagination-container">
      <ul class="pagination" id="pagination">
        <li class="page-item disabled">
          <a class="page-link" href="#" id="prevBtn" aria-label="Previous">
            <i class="fas fa-chevron-left"></i>
          </a>
        </li>
        <li class="page-item active"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
          <a class="page-link" href="#" id="nextBtn" aria-label="Next">
            <i class="fas fa-chevron-right"></i>
          </a>
        </li>
      </ul>
    </nav>
  </main>
</div>

<!-- Service Advisor Details Modal -->
<div class="modal fade premium-modal" id="advisorDetailsModal" tabindex="-1" aria-labelledby="advisorDetailsModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="advisorDetailsModalLabel">
          <i class="fas fa-user-tie"></i>
          <span>Service Advisor Details</span>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="profile-tabs">
        <div class="profile-tab active" data-tab="info">Personal Info</div>
        <div class="profile-tab" data-tab="workload">Workload</div>
      </div>

      <div class="modal-body">
        <!-- Personal Info Tab -->
        <div class="tab-content active" id="info-tab">
          <div class="modal-body-inner">
            <!-- Service Advisor Profile -->
            <div class="advisor-profile">
              <div class="profile-section">
                <div class="profile-avatar" id="viewAdvisorInitials">MS</div>
                <div class="profile-detail">
                  <div class="profile-label">Full Name</div>
                  <div class="profile-value" id="viewAdvisorName">Mike Smith</div>
                </div>
                <div class="profile-detail">
                  <div class="profile-label">Email</div>
                  <div class="profile-value" id="viewAdvisorEmail">mike.smith@example.com</div>
                </div>
                <div class="profile-detail">
                  <div class="profile-label">Phone</div>
                  <div class="profile-value" id="viewAdvisorPhone">+91 98765 43210</div>
                </div>
              </div>

              <div class="profile-section">
                <div class="profile-detail">
                  <div class="profile-label">ID</div>
                  <div class="profile-value" id="viewAdvisorId">SA-001</div>
                </div>
                <div class="profile-detail">
                  <div class="profile-label">Department</div>
                  <div class="profile-value" id="viewAdvisorDepartment">Mechanical Services</div>
                </div>
                <div class="profile-detail">
                  <div class="profile-label">Hire Date</div>
                  <div class="profile-value" id="viewAdvisorHireDate">March 15, 2023</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Workload Tab -->
        <div class="tab-content" id="workload-tab">
          <div class="modal-body-inner">
            <div class="workload-overview">
              <div class="workload-card">
                <div class="workload-header">
                  <div class="workload-title">Current Workload</div>
                  <div class="workload-value" id="viewAdvisorWorkloadValue">65%</div>
                </div>
                <div class="workload-container">
                  <div class="workload-progress medium" id="viewAdvisorWorkloadBar" style="width: 65%;"></div>
                </div>
                <div class="workload-text" id="viewAdvisorWorkloadText">Moderate workload - can take on more services</div>
              </div>
            </div>

            <h4 class="section-title">
              <i class="fas fa-clipboard-list"></i>
              Active Service Requests
            </h4>

            <table class="active-services-table">
              <thead>
              <tr>
                <th>Service ID</th>
                <th>Vehicle</th>
                <th>Customer</th>
                <th>Service Type</th>
                <th>Status</th>
              </tr>
              </thead>
              <tbody id="activeServicesTableBody">
              <!-- Will be populated with active services -->
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="premium-btn secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="premium-btn primary" id="editAdvisorFromDetailsBtn">Edit Service Advisor</button>
      </div>
    </div>
  </div>
</div>

<!-- Add Service Advisor Modal -->
<div class="modal fade premium-modal" id="addAdvisorModal" tabindex="-1" aria-labelledby="addAdvisorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addAdvisorModalLabel">
          <i class="fas fa-user-plus"></i>
          Add New Service Advisor
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="modal-body-inner">
          <form id="addAdvisorForm">
            <div class="form-section">
              <h4 class="section-title">
                <i class="fas fa-user"></i>
                Personal Information
              </h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="firstName" class="form-label">First Name *</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="lastName" class="form-label">Last Name *</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="email" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <div class="form-group">
                  <label for="phone" class="form-label">Phone Number *</label>
                  <input type="tel" class="form-control" id="phone" name="phoneNumber" required>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h4 class="section-title">
                <i class="fas fa-briefcase"></i>
                Professional Information
              </h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="department" class="form-label">Department *</label>
                  <select class="form-select" id="department" name="department" required>
                    <option value="">Select Department</option>
                    <option value="Mechanical Services">Mechanical Services</option>
                    <option value="Electrical Services">Electrical Services</option>
                    <option value="Body Shop">Body Shop</option>
                    <option value="Diagnostics">Diagnostics</option>
                    <option value="Customer Service">Customer Service</option>
                  </select>
                </div>
              </div>
              <div class="alert alert-info mt-3">
                <i class="fas fa-info-circle me-2"></i>
                <span>A temporary password will be automatically generated and sent to the service advisor's email for their first login.</span>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="premium-btn secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="premium-btn primary" id="saveAdvisorBtn">Add Service Advisor</button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Service Advisor Modal -->
<div class="modal fade premium-modal" id="editAdvisorModal" tabindex="-1" aria-labelledby="editAdvisorModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="editAdvisorModalLabel">
          <i class="fas fa-user-edit"></i>
          Edit Service Advisor
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <div class="modal-body-inner">
          <form id="editAdvisorForm">
            <input type="hidden" id="editAdvisorId" name="advisorId">
            <input type="hidden" id="editUserId" name="userId">

            <div class="form-section">
              <h4 class="section-title">
                <i class="fas fa-user"></i>
                Personal Information
              </h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="editFirstName" class="form-label">First Name *</label>
                  <input type="text" class="form-control" id="editFirstName" name="firstName" required>
                </div>
                <div class="form-group">
                  <label for="editLastName" class="form-label">Last Name *</label>
                  <input type="text" class="form-control" id="editLastName" name="lastName" required>
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="editEmail" class="form-label">Email Address *</label>
                  <input type="email" class="form-control" id="editEmail" name="email" required>
                </div>
                <div class="form-group">
                  <label for="editPhone" class="form-label">Phone Number *</label>
                  <input type="tel" class="form-control" id="editPhone" name="phoneNumber" required>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h4 class="section-title">
                <i class="fas fa-briefcase"></i>
                Professional Information
              </h4>
              <div class="form-row">
                <div class="form-group">
                  <label for="editDepartment" class="form-label">Department *</label>
                  <select class="form-select" id="editDepartment" name="department" required>
                    <option value="">Select Department</option>
                    <option value="Mechanical Services">Mechanical Services</option>
                    <option value="Electrical Services">Electrical Services</option>
                    <option value="Body Shop">Body Shop</option>
                    <option value="Diagnostics">Diagnostics</option>
                    <option value="Customer Service">Customer Service</option>
                  </select>
                </div>
              </div>
              <div class="form-group">
                <label for="editPassword" class="form-label">Reset Password</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="editPassword" name="password" placeholder="Leave blank to keep current password">
                  <button class="btn btn-outline-secondary" type="button" id="resetPasswordBtn">Reset</button>
                </div>
                <small class="form-text text-muted">Click "Reset" to generate a new password that will be sent to the advisor's email.</small>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="premium-btn secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="premium-btn primary" id="updateAdvisorBtn">Update Service Advisor</button>
      </div>
    </div>
  </div>
</div>

<!-- Success Confirmation Modal -->
<div class="modal fade confirmation-modal" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-body">
        <div class="confirmation-icon">
          <i class="fas fa-check"></i>
        </div>
        <h3 class="confirmation-title" id="confirmationTitle">Success!</h3>
        <p class="confirmation-message" id="confirmationMessage">The operation was completed successfully.</p>
        <button type="button" class="confirmation-btn" data-bs-dismiss="modal">Continue</button>
      </div>
    </div>
  </div>
</div>

<!-- jQuery and Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

<!-- Custom JS -->
<script th:inline="javascript">// Make serviceAdvisors a global variable
let serviceAdvisors = [];
let currentPage = 1;
const itemsPerPage = 8; // Changed from 10 to 8 for grid layout
let currentFilter = 'all';

// Wait for DOM to be loaded
document.addEventListener('DOMContentLoaded', function() {
  // Initialize app
  initializeApp();

  // Set up event listeners
  setupEventListeners();

  // Load service advisors
  loadServiceAdvisors();

  function initializeApp() {
    // Setup mobile menu toggle
    setupMobileMenu();

    // Setup logout button
    setupLogout();

    // Set up token-based authentication
    setupAuthentication();

    // Set up navigation and active menu
    setupNavigation();
  }

  function setupMobileMenu() {
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    if (mobileMenuToggle) {
      mobileMenuToggle.addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('active');
      });
    }
  }

  function setupLogout() {
    const logoutBtn = document.getElementById('logoutBtn');
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function() {
        // Clear storage
        localStorage.removeItem("jwt-token");
        sessionStorage.removeItem("jwt-token");
        localStorage.removeItem("user-role");
        localStorage.removeItem("user-name");
        sessionStorage.removeItem("user-role");
        sessionStorage.removeItem("user-name");

        // Redirect to logout
        window.location.href = '/admin/logout';
      });
    }
  }

  function setupAuthentication() {
    // Get token from storage
    const tokenFromStorage = localStorage.getItem("jwt-token") || sessionStorage.getItem("jwt-token");

    if (tokenFromStorage) {
      console.log("Token found in storage");
    } else {
      console.warn("No token found in storage");
      // If no token is found, redirect to login
      window.location.href = '/admin/login?error=session_expired';
    }
  }

  function setupNavigation() {
    // Get the current path
    const currentPath = window.location.pathname;

    // Set active class on sidebar menu items based on current path
    document.querySelectorAll('.sidebar-menu-link').forEach(link => {
      const href = link.getAttribute('href');
      if (href && currentPath.includes(href.split('?')[0])) {
        link.classList.add('active');
      } else {
        link.classList.remove('active');
      }
    });
  }

  function setupEventListeners() {
    // Add service advisor button
    const addAdvisorBtn = document.getElementById('addAdvisorBtn');
    if (addAdvisorBtn) {
      addAdvisorBtn.addEventListener('click', function() {
        // Reset form
        document.getElementById('addAdvisorForm').reset();

        // Show add advisor modal
        const addAdvisorModal = new bootstrap.Modal(document.getElementById('addAdvisorModal'));
        addAdvisorModal.show();
      });
    }

    // Save service advisor button
    const saveAdvisorBtn = document.getElementById('saveAdvisorBtn');
    if (saveAdvisorBtn) {
      saveAdvisorBtn.addEventListener('click', saveServiceAdvisor);
    }

    // Edit service advisor button from details
    const editAdvisorFromDetailsBtn = document.getElementById('editAdvisorFromDetailsBtn');
    if (editAdvisorFromDetailsBtn) {
      editAdvisorFromDetailsBtn.addEventListener('click', function() {
        const advisorId = this.getAttribute('data-advisor-id');
        showEditModal(advisorId);
      });
    }

    // Update service advisor button
    const updateAdvisorBtn = document.getElementById('updateAdvisorBtn');
    if (updateAdvisorBtn) {
      updateAdvisorBtn.addEventListener('click', updateServiceAdvisor);
    }

    // Reset password button
    const resetPasswordBtn = document.getElementById('resetPasswordBtn');
    if (resetPasswordBtn) {
      resetPasswordBtn.addEventListener('click', function() {
        const generatedPassword = generateRandomPassword();
        document.getElementById('editPassword').value = generatedPassword;

        // Show success message that password will be sent by email
        showConfirmation(
                "Password Reset",
                "A new temporary password has been generated and will be sent to the service advisor's email."
        );
      });
    }

    // Profile tabs functionality
    const profileTabs = document.querySelectorAll('.profile-tab');
    profileTabs.forEach(tab => {
      tab.addEventListener('click', function() {
        // Get the tab ID
        const tabId = this.getAttribute('data-tab');

        // Remove active class from all tabs and tab contents
        profileTabs.forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        // Add active class to clicked tab and corresponding content
        this.classList.add('active');
        document.getElementById(`${tabId}-tab`).classList.add('active');
      });
    });

    // Search functionality
    const searchInput = document.getElementById('advisorSearch');
    if (searchInput) {
      searchInput.addEventListener('keyup', function() {
        filterServiceAdvisors(this.value);
      });
    }

    // Filter pills functionality
    const filterPills = document.querySelectorAll('.filter-pill');
    filterPills.forEach(pill => {
      pill.addEventListener('click', function() {
        // Remove active class from all pills
        filterPills.forEach(p => p.classList.remove('active'));

        // Add active class to clicked pill
        this.classList.add('active');

        // Set current filter
        currentFilter = this.textContent.trim().toLowerCase().replace(' ', '-');

        // Reset to first page
        currentPage = 1;

        // Render with new filter
        renderServiceAdvisors();
      });
    });

    // Pagination
    const prevBtn = document.getElementById('prevBtn');
    if (prevBtn) {
      prevBtn.addEventListener('click', function(e) {
        e.preventDefault();
        if (currentPage > 1) {
          currentPage--;
          renderServiceAdvisors();
          updatePaginationUI();
        }
      });
    }

    const nextBtn = document.getElementById('nextBtn');
    if (nextBtn) {
      nextBtn.addEventListener('click', function(e) {
        e.preventDefault();
        const filteredAdvisors = getFilteredAdvisors();
        const totalPages = Math.ceil(filteredAdvisors.length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          renderServiceAdvisors();
          updatePaginationUI();
        }
      });
    }

    // Sort dropdown functionality
    const sortDropdownItems = document.querySelectorAll('.dropdown-menu .dropdown-item');
    sortDropdownItems.forEach(item => {
      item.addEventListener('click', function(e) {
        e.preventDefault();

        // Remove active class from all items
        sortDropdownItems.forEach(i => i.classList.remove('active'));

        // Add active class to clicked item
        this.classList.add('active');

        // Update dropdown button text
        document.getElementById('sortDropdown').innerHTML = `
                  <i class="fas fa-sort"></i>
                  Sort by: ${this.textContent}
              `;

        // Sort service advisors
        sortServiceAdvisors(this.textContent.toLowerCase());
      });
    });
  }
});

// Move all helper functions and other functions that use serviceAdvisors outside the document ready handler,
// but make sure they can access the now-global serviceAdvisors variable

function getToken() {
  return localStorage.getItem('jwt-token') || sessionStorage.getItem('jwt-token');
}

function showSpinner() {
  const spinnerOverlay = document.getElementById('spinnerOverlay');
  if (spinnerOverlay) {
    spinnerOverlay.classList.add('show');
  }
}

function hideSpinner() {
  const spinnerOverlay = document.getElementById('spinnerOverlay');
  if (spinnerOverlay) {
    setTimeout(() => {
      spinnerOverlay.classList.remove('show');
    }, 500); // Minimum show time for spinner
  }
}

function showConfirmation(title, message) {
  document.getElementById('confirmationTitle').textContent = title;
  document.getElementById('confirmationMessage').textContent = message;
  const successModal = new bootstrap.Modal(document.getElementById('successModal'));
  successModal.show();
}

function loadServiceAdvisors() {
  showSpinner();

  // Call API to get service advisors
  fetch('/admin/service-advisors/api/advisors', {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + getToken()
    }
  })
          .then(response => {
            if (!response.ok) {
              if (response.status === 401) {
                // Redirect to login on auth failure
                window.location.href = '/admin/login?error=session_expired';
                throw new Error('Session expired');
              }
              throw new Error(`Server responded with status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            hideSpinner();

            // Store service advisors globally
            serviceAdvisors = data;

            // Render service advisors
            renderServiceAdvisors();

            // Setup pagination
            setupPagination();
          })
          .catch(error => {
            hideSpinner();
            console.error('Error fetching advisor details:', error);
            alert('Failed to load advisor details. Please try again.');
          });
}

function getFilteredAdvisors() {
  const searchTerm = document.getElementById('advisorSearch').value.toLowerCase();

  // First filter by search term
  let filtered = serviceAdvisors.filter(advisor => {
    // Search in name, email, ID, and department
    return (
            (advisor.firstName + ' ' + advisor.lastName).toLowerCase().includes(searchTerm) ||
            advisor.email.toLowerCase().includes(searchTerm) ||
            (advisor.formattedId || '').toLowerCase().includes(searchTerm) ||
            (advisor.department || '').toLowerCase().includes(searchTerm)
    );
  });

  // Then filter by selected filter pill
  if (currentFilter !== 'all-advisors') {
    if (currentFilter === 'high-workload') {
      filtered = filtered.filter(advisor => advisor.workloadPercentage >= 75);
    } else if (currentFilter === 'available') {
      filtered = filtered.filter(advisor => advisor.workloadPercentage < 50);
    }
  }

  return filtered;
}

function renderServiceAdvisors() {
  // Get filtered advisors based on current filter and search term
  const filteredAdvisors = getFilteredAdvisors();

  // Calculate pagination
  const startIndex = (currentPage - 1) * itemsPerPage;
  const endIndex = startIndex + itemsPerPage;
  const paginatedAdvisors = filteredAdvisors.slice(startIndex, endIndex);

  // Get the grid container
  const gridContainer = document.getElementById('advisorsGrid');

  // Clear grid
  gridContainer.innerHTML = '';

  // Check if there are service advisors
  if (paginatedAdvisors.length === 0) {
    gridContainer.innerHTML = `
      <div class="no-advisors-message">
        <i class="fas fa-user-tie fa-3x mb-3 text-muted"></i>
        <h4>No service advisors found</h4>
        <p class="text-muted">Try adjusting your filters or add a new service advisor</p>
      </div>
    `;
    return;
  }

  // Populate grid with service advisor cards
  paginatedAdvisors.forEach(advisor => {
    // Determine workload class
    const workloadClass = getWorkloadClass(advisor.workloadPercentage);

    // Create advisor card
    const card = document.createElement('div');
    card.className = 'advisor-card';
    card.addEventListener('click', function() {
      showAdvisorDetails(advisor);
    });

    // Create card contents
    card.innerHTML = `
      <div class="advisor-card-header">
        <div class="advisor-avatar">${getInitials(advisor.firstName, advisor.lastName)}</div>
        <div class="advisor-header-info">
          <div class="advisor-name">${advisor.firstName} ${advisor.lastName}</div>
          <div class="advisor-id">${advisor.formattedId || ('SA-' + advisor.advisorId)}</div>
        </div>
      </div>
      <div class="advisor-card-body">
        <div class="advisor-detail">
          <div class="advisor-detail-icon">
            <i class="fas fa-envelope"></i>
          </div>
          <div class="advisor-detail-content">
            <div class="advisor-detail-label">Email</div>
            <div class="advisor-detail-value">${advisor.email}</div>
          </div>
        </div>
        <div class="advisor-detail">
          <div class="advisor-detail-icon">
            <i class="fas fa-phone"></i>
          </div>
          <div class="advisor-detail-content">
            <div class="advisor-detail-label">Phone</div>
            <div class="advisor-detail-value">${advisor.phoneNumber}</div>
          </div>
        </div>
        <div class="advisor-detail">
          <div class="advisor-detail-icon">
            <i class="fas fa-building"></i>
          </div>
          <div class="advisor-detail-content">
            <div class="advisor-detail-label">Department</div>
            <div class="advisor-detail-value">${advisor.department || 'Not assigned'}</div>
          </div>
        </div>
      </div>
      <div class="advisor-card-footer">
        <div class="workload-container">
          <div class="workload-progress ${workloadClass}" style="width: ${advisor.workloadPercentage}%;"></div>
        </div>
        <div class="workload-text">
          <span>Workload</span>
          <span class="workload-label">${advisor.workloadPercentage}% (${advisor.activeServices} active)</span>
        </div>
      </div>
    `;

    // Add card to grid
    gridContainer.appendChild(card);
  });

  // Update pagination
  updatePaginationUI();
}

function updatePaginationUI() {
  const filteredAdvisors = getFilteredAdvisors();
  const totalPages = Math.ceil(filteredAdvisors.length / itemsPerPage);

  // Get pagination container
  const pagination = document.getElementById('pagination');

  // Clear pagination
  pagination.innerHTML = '';

  // Add previous button
  const prevBtn = document.createElement('li');
  prevBtn.className = 'page-item ' + (currentPage === 1 ? 'disabled' : '');
  prevBtn.innerHTML = `
  <a class="page-link" href="#" aria-label="Previous">
      <i class="fas fa-chevron-left"></i>
  </a>
  `;
  prevBtn.addEventListener('click', function(e) {
    e.preventDefault();
    if (currentPage > 1) {
      currentPage--;
      renderServiceAdvisors();
    }
  });
  pagination.appendChild(prevBtn);

  // Add page numbers
  for (let i = 1; i <= totalPages; i++) {
    const pageItem = document.createElement('li');
    pageItem.className = 'page-item ' + (i === currentPage ? 'active' : '');
    pageItem.innerHTML = `<a class="page-link" href="#">${i}</a>`;
    pageItem.addEventListener('click', function(e) {
      e.preventDefault();
      currentPage = i;
      renderServiceAdvisors();
    });
    pagination.appendChild(pageItem);
  }

  // Add next button
  const nextBtn = document.createElement('li');
  nextBtn.className = 'page-item ' + (currentPage === totalPages || totalPages === 0 ? 'disabled' : '');
  nextBtn.innerHTML = `
  <a class="page-link" href="#" aria-label="Next">
      <i class="fas fa-chevron-right"></i>
  </a>
  `;
  nextBtn.addEventListener('click', function(e) {
    e.preventDefault();
    if (currentPage < totalPages) {
      currentPage++;
      renderServiceAdvisors();
    }
  });
  pagination.appendChild(nextBtn);
}

function setupPagination() {
  const filteredAdvisors = getFilteredAdvisors();
  const totalPages = Math.ceil(filteredAdvisors.length / itemsPerPage);

  // Update pagination UI
  updatePaginationUI();
}

function getInitials(firstName, lastName) {
  const firstInitial = firstName ? firstName.charAt(0).toUpperCase() : '';
  const lastInitial = lastName ? lastName.charAt(0).toUpperCase() : '';
  return firstInitial + lastInitial;
}

function getWorkloadClass(percentage) {
  if (percentage >= 75) {
    return 'high';
  } else if (percentage >= 50) {
    return 'medium';
  } else {
    return 'low';
  }
}

function getStatusIcon(status) {
  switch (status.toLowerCase()) {
    case 'received':
      return 'clipboard-check';
    case 'diagnosis':
      return 'stethoscope';
    case 'repair':
      return 'tools';
    case 'completed':
      return 'check-circle';
    default:
      return 'circle';
  }
}


function getWorkloadText(percentage) {
  if (percentage >= 75) {
    return 'High workload';
  } else if (percentage >= 50) {
    return 'Moderate workload';
  } else {
    return 'Available for new services';
  }
}

function getActiveServicesClass(count) {
  if (count >= 6) {
    return 'danger';
  } else if (count >= 3) {
    return 'warning';
  } else {
    return 'success';
  }
}

function showAdvisorDetails(advisor) {
  // Set advisor ID on edit button for future reference
  document.getElementById('editAdvisorFromDetailsBtn').setAttribute('data-advisor-id', advisor.advisorId);

  // Personal Info Tab
  document.getElementById('viewAdvisorInitials').textContent = getInitials(advisor.firstName, advisor.lastName);
  document.getElementById('viewAdvisorName').textContent = advisor.firstName + ' ' + advisor.lastName;
  document.getElementById('viewAdvisorEmail').textContent = advisor.email;
  document.getElementById('viewAdvisorPhone').textContent = advisor.phoneNumber;
  document.getElementById('viewAdvisorId').textContent = advisor.formattedId || ('SA-' + advisor.advisorId);
  document.getElementById('viewAdvisorDepartment').textContent = advisor.department || 'Not assigned';
  document.getElementById('viewAdvisorHireDate').textContent = advisor.hireDate ? new Date(advisor.hireDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) : 'Not available';

  // Workload Tab
  document.getElementById('viewAdvisorWorkloadValue').textContent = advisor.workloadPercentage + '%';

  const workloadBar = document.getElementById('viewAdvisorWorkloadBar');
  workloadBar.style.width = advisor.workloadPercentage + '%';
  workloadBar.className = 'workload-progress ' + getWorkloadClass(advisor.workloadPercentage);

  document.getElementById('viewAdvisorWorkloadText').textContent = getWorkloadText(advisor.workloadPercentage);

  // Show modal
  const detailsModal = new bootstrap.Modal(document.getElementById('advisorDetailsModal'));
  detailsModal.show();
}

function generateRandomPassword() {
  // Generate a password in the format: SA2025-XXXNNN (where X is a letter and N is a number)
  const letters = 'ABCDEFGHJKLMNPQRSTUVWXYZ'; // Excluded I and O to avoid confusion
  const numbers = '123456789'; // Excluded 0 to avoid confusion

  let password = 'SA2025-';

  // Add 3 random letters
  for (let i = 0; i < 3; i++) {
    password += letters.charAt(Math.floor(Math.random() * letters.length));
  }

  // Add 3 random numbers
  for (let i = 0; i < 3; i++) {
    password += numbers.charAt(Math.floor(Math.random() * numbers.length));
  }

  return password;
}

function saveServiceAdvisor() {
  // Get form
  const form = document.getElementById('addAdvisorForm');

  // Basic form validation
  if (!form.checkValidity()) {
    form.reportValidity();
    return;
  }

  // Generate a random password for the new advisor
  const generatedPassword = generateRandomPassword();

  // Get form data
  const formData = {
    firstName: document.getElementById('firstName').value,
    lastName: document.getElementById('lastName').value,
    email: document.getElementById('email').value,
    phoneNumber: document.getElementById('phone').value,
    department: document.getElementById('department').value,
    password: generatedPassword // Add the generated password to the request
  };

  showSpinner();

  // Call API to create new service advisor
  fetch('/admin/service-advisors', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + getToken()
    },
    body: JSON.stringify(formData)
  })
          .then(response => {
            if (!response.ok) {
              // Log the status for debugging
              console.error(`Server responded with status: ${response.status}`);

              // Try to get more detailed error message
              return response.text().then(text => {
                throw new Error(`Server responded with status: ${response.status}` +
                        (text ? `, message: ${text}` : ''));
              });
            }
            return response.json();
          })
          .then(data => {
            hideSpinner();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('addAdvisorModal'));
            modal.hide();

            // Show success message about email
            showConfirmation(
                    "Service Advisor Added Successfully",
                    "The service advisor has been created and login credentials have been sent to their email address."
            );

            // Reset form
            form.reset();

            // Reload service advisors
            loadServiceAdvisors();
          })
          .catch(error => {
            hideSpinner();
            console.error('Error creating service advisor:', error);

            // Show user-friendly error message
            alert('Failed to create service advisor. ' +
                    (error.message || 'Please check your connection and try again.'));
          });
}

function showEditModal(advisorId) {
  // Close details modal if open
  const detailsModal = bootstrap.Modal.getInstance(document.getElementById('advisorDetailsModal'));
  if (detailsModal) {
    detailsModal.hide();
  }

  showSpinner();

  // Call API to get advisor details for editing
  fetch(`/admin/service-advisors/${advisorId}`, {
    method: 'GET',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + getToken()
    }
  })
          .then(response => {
            if (!response.ok) {
              throw new Error(`Server responded with status: ${response.status}`);
            }
            return response.json();
          })
          .then(advisor => {
            hideSpinner();

            // Populate edit form
            document.getElementById('editAdvisorId').value = advisor.advisorId;
            document.getElementById('editUserId').value = advisor.userId;
            document.getElementById('editFirstName').value = advisor.firstName;
            document.getElementById('editLastName').value = advisor.lastName;
            document.getElementById('editEmail').value = advisor.email;
            document.getElementById('editPhone').value = advisor.phoneNumber;
            document.getElementById('editDepartment').value = advisor.department;
            document.getElementById('editPassword').value = '';

            // Show edit modal
            const editModal = new bootstrap.Modal(document.getElementById('editAdvisorModal'));
            editModal.show();
          })
          .catch(error => {
            hideSpinner();
            console.error('Error fetching advisor details for editing:', error);
            alert('Failed to load advisor details for editing. Please try again.');
          });
}

function updateServiceAdvisor() {
  // Get form
  const form = document.getElementById('editAdvisorForm');

  // Basic form validation
  if (!form.checkValidity()) {
    form.reportValidity();
    return;
  }

  // Get advisor ID
  const advisorId = document.getElementById('editAdvisorId').value;

  // Get form data
  const formData = {
    advisorId: advisorId,
    userId: document.getElementById('editUserId').value,
    firstName: document.getElementById('editFirstName').value,
    lastName: document.getElementById('editLastName').value,
    email: document.getElementById('editEmail').value,
    phoneNumber: document.getElementById('editPhone').value,
    department: document.getElementById('editDepartment').value
  };

  // Add password if provided
  const password = document.getElementById('editPassword').value;
  if (password) {
    formData.password = password;
  }

  showSpinner();

  // Call API to update service advisor
  fetch(`/admin/service-advisors/${advisorId}`, {
    method: 'PUT',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': 'Bearer ' + getToken()
    },
    body: JSON.stringify(formData)
  })
          .then(response => {
            if (!response.ok) {
              throw new Error(`Server responded with status: ${response.status}`);
            }
            return response.json();
          })
          .then(data => {
            hideSpinner();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('editAdvisorModal'));
            modal.hide();

            // Show success message
            showConfirmation(
                    'Service Advisor Updated',
                    'The service advisor information has been updated successfully.' +
                    (password ? ' A new password has been sent to their email.' : '')
            );

            // Reset form
            form.reset();

            // Reload service advisors
            loadServiceAdvisors();
          })
          .catch(error => {
            hideSpinner();
            console.error('Error updating service advisor:', error);
            alert('Failed to update service advisor. Please try again.');
          });
}

function filterServiceAdvisors(searchTerm) {
  // Reset to first page
  currentPage = 1;

  // Render with new search term (getFilteredAdvisors will use the search input value)
  renderServiceAdvisors();
}

function sortServiceAdvisors(sortBy) {
  // Sort the service advisors array based on the sortBy parameter
  serviceAdvisors.sort((a, b) => {
    switch (sortBy) {
      case 'name':
        return (a.firstName + a.lastName).localeCompare(b.firstName + b.lastName);
      case 'department':
        return (a.department || '').localeCompare(b.department || '');
      case 'workload':
        return b.workloadPercentage - a.workloadPercentage;
      case 'hire date':
        return new Date(a.hireDate || 0) - new Date(b.hireDate || 0);
      default:
        return 0;
    }
  });

  // Re-render the service advisors
  renderServiceAdvisors();
}
</script>
</body>
</html>